<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçû Panader√≠a San Jos√© - Sistema de Gesti√≥n</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- El contenido se carga din√°micamente por JavaScript -->
    <div id="app">
        <div class="d-flex justify-content-center align-items-center min-vh-100">
            <div class="text-center">
                <div class="spinner-border text-warning mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <h4 class="text-muted">üçû Cargando Sistema de Panader√≠a...</h4>
                <p class="text-muted">Por favor espera un momento...</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Sistema Principal -->
    <script>
        /**
         * SISTEMA DE GESTI√ìN DE PANADER√çA - FUNCIONAL COMPLETO
         */
        class PanaderiaApp {
            constructor() {
                this.init();
            }

            init() {
                console.log('üçû Iniciando Sistema de Panader√≠a...');
                // Peque√±o delay para mostrar el loading
                setTimeout(() => {
                    this.showLogin();
                    this.bindEvents();
                }, 500);
            }

            bindEvents() {
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'loginBtn') {
                        e.preventDefault();
                        this.handleLogin();
                    }
                    
                    if (e.target.id === 'logoutBtn') {
                        e.preventDefault();
                        this.handleLogout();
                    }
                });
            }

            showLogin() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="min-vh-100 d-flex align-items-center justify-content-center" style="background: linear-gradient(135deg, #fef9e7 0%, #f39c12 100%);">
                        <div class="container">
                            <div class="row justify-content-center">
                                <div class="col-md-6 col-lg-4">
                                    <div class="card shadow-lg border-0 rounded-3">
                                        <div class="card-body p-5">
                                            <div class="text-center mb-4">
                                                <i class="fas fa-bread-slice fa-3x text-warning mb-3"></i>
                                                <h3 class="fw-bold text-primary">üçû Panader√≠a San Jos√©</h3>
                                                <p class="text-muted">Sistema de Gesti√≥n Integral</p>
                                            </div>
                                            
                                            <form id="loginForm">
                                                <div class="mb-3">
                                                    <label for="email" class="form-label">
                                                        <i class="fas fa-envelope me-2"></i>Correo Electr√≥nico
                                                    </label>
                                                    <input type="email" class="form-control form-control-lg" 
                                                           id="email" value="admin@panaderia.com" required>
                                                </div>
                                                
                                                <div class="mb-4">
                                                    <label for="password" class="form-label">
                                                        <i class="fas fa-lock me-2"></i>Contrase√±a
                                                    </label>
                                                    <input type="password" class="form-control form-control-lg" 
                                                           id="password" value="password" required>
                                                </div>
                                                
                                                <div class="d-grid">
                                                    <button type="submit" id="loginBtn" class="btn btn-primary btn-lg">
                                                        <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesi√≥n
                                                    </button>
                                                </div>
                                            </form>
                                            
                                            <div class="text-center mt-4">
                                                <small class="text-muted">
                                                    <i class="fas fa-info-circle me-1"></i>
                                                    Credenciales: admin@panaderia.com / password
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            async handleLogin() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (email === 'admin@panaderia.com' && password === 'password') {
                    this.showToast('¬°Bienvenido al sistema!', 'success');
                    await this.loadDashboard();
                } else {
                    this.showToast('Credenciales incorrectas', 'error');
                }
            }

            handleLogout() {
                this.showToast('Sesi√≥n cerrada correctamente', 'success');
                this.showLogin();
            }

            async loadDashboard() {
                try {
                    this.showToast('Cargando datos del dashboard...', 'info');
                    
                    const response = await fetch('dashboard_simple.php');
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showDashboard(result.data);
                    } else {
                        this.showToast('Error al cargar datos: ' + result.message, 'error');
                        // Mostrar dashboard con datos de ejemplo
                        this.showDashboard(this.getDemoData());
                    }
                } catch (error) {
                    console.error('Error:', error);
                    this.showToast('Conectando con datos de demostraci√≥n...', 'warning');
                    // Mostrar dashboard con datos de ejemplo
                    this.showDashboard(this.getDemoData());
                }
            }

            getDemoData() {
                return {
                    ventasHoy: 2450.75,
                    productosActivos: 35,
                    empleadosActivos: 8,
                    ventasMes: 78500.50,
                    ventasChart: {
                        labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                        data: [1200, 1900, 3000, 2100, 2800, 3200, 2450]
                    },
                    productosPopulares: [
                        { nombre: 'Pan Franc√©s', ventas: 45 },
                        { nombre: 'Croissant', ventas: 38 },
                        { nombre: 'Pan Dulce', ventas: 32 },
                        { nombre: 'Empanadas', ventas: 28 },
                        { nombre: 'Torta Chocolate', ventas: 25 }
                    ],
                    alertasStock: [
                        { producto: 'Harina', stock: 5, minimo: 10 },
                        { producto: 'Az√∫car', stock: 8, minimo: 15 },
                        { producto: 'Mantequilla', stock: 3, minimo: 5 }
                    ]
                };
            }

            showDashboard(data) {
                const app = document.getElementById('app');
                
                app.innerHTML = `
                    <!-- Navbar -->
                    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
                        <div class="container-fluid">
                            <a class="navbar-brand fw-bold">
                                <i class="fas fa-bread-slice me-2"></i>Panader√≠a San Jos√©
                            </a>
                            
                            <div class="navbar-nav ms-auto">
                                <span class="navbar-text me-3">
                                    <i class="fas fa-user me-1"></i>Administrador
                                </span>
                                <button class="btn btn-outline-light" id="logoutBtn">
                                    <i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesi√≥n
                                </button>
                            </div>
                        </div>
                    </nav>

                    <!-- Contenido Principal -->
                    <div class="container-fluid py-4">
                        <!-- Estad√≠sticas Principales -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card bg-success text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="card-title mb-0">Ventas Hoy</h6>
                                                <h3 class="mb-0">$${this.formatNumber(data.ventasHoy)}</h3>
                                            </div>
                                            <div>
                                                <i class="fas fa-cash-register fa-2x opacity-75"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="card bg-info text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="card-title mb-0">Productos Activos</h6>
                                                <h3 class="mb-0">${data.productosActivos}</h3>
                                            </div>
                                            <div>
                                                <i class="fas fa-box fa-2x opacity-75"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="card bg-warning text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="card-title mb-0">Empleados</h6>
                                                <h3 class="mb-0">${data.empleadosActivos}</h3>
                                            </div>
                                            <div>
                                                <i class="fas fa-users fa-2x opacity-75"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <div class="card bg-danger text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="card-title mb-0">Ventas del Mes</h6>
                                                <h3 class="mb-0">$${this.formatNumber(data.ventasMes)}</h3>
                                            </div>
                                            <div>
                                                <i class="fas fa-chart-line fa-2x opacity-75"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gr√°fico y Listas -->
                        <div class="row">
                            <!-- Gr√°fico de Ventas -->
                            <div class="col-lg-8 mb-4">
                                <div class="card shadow-sm h-100">
                                    <div class="card-header bg-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-chart-bar me-2 text-primary"></i>
                                            Ventas de la Semana
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="ventasChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Productos Populares -->
                            <div class="col-lg-4 mb-4">
                                <div class="card shadow-sm h-100">
                                    <div class="card-header bg-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-star me-2 text-warning"></i>
                                            Productos Populares
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        ${this.renderProductosPopulares(data.productosPopulares)}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alertas de Stock -->
                        ${data.alertasStock.length > 0 ? `
                        <div class="row">
                            <div class="col-12">
                                <div class="card shadow-sm">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="mb-0">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            Alertas de Stock Bajo
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        ${this.renderAlertasStock(data.alertasStock)}
                                    </div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;

                // Inicializar gr√°fico
                setTimeout(() => {
                    this.initChart(data.ventasChart);
                }, 100);
            }

            renderProductosPopulares(productos) {
                if (!productos || productos.length === 0) {
                    return '<p class="text-muted">No hay datos disponibles</p>';
                }

                return productos.map((producto, index) => `
                    <div class="d-flex justify-content-between align-items-center py-2 ${index < productos.length - 1 ? 'border-bottom' : ''}">
                        <div>
                            <h6 class="mb-0">${producto.nombre}</h6>
                        </div>
                        <span class="badge bg-primary rounded-pill">${producto.ventas} ventas</span>
                    </div>
                `).join('');
            }

            renderAlertasStock(alertas) {
                return `
                    <div class="row">
                        ${alertas.map(alerta => `
                            <div class="col-md-4 mb-2">
                                <div class="alert alert-warning mb-0 p-2">
                                    <strong>${alerta.producto}</strong><br>
                                    <small>Stock: ${alerta.stock} (M√≠n: ${alerta.minimo})</small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            initChart(chartData) {
                const ctx = document.getElementById('ventasChart');
                if (!ctx) return;

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            label: 'Ventas ($)',
                            data: chartData.data,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            formatNumber(num) {
                return parseFloat(num).toLocaleString('es-ES', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }

            showToast(message, type = 'info') {
                let toastContainer = document.getElementById('toastContainer');
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.id = 'toastContainer';
                    toastContainer.className = 'position-fixed top-0 end-0 p-3';
                    toastContainer.style.zIndex = '1050';
                    document.body.appendChild(toastContainer);
                }

                const toastId = 'toast' + Date.now();
                const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : type === 'warning' ? 'bg-warning' : 'bg-info';
                
                const toastHtml = `
                    <div id="${toastId}" class="toast ${bgClass} text-white" role="alert">
                        <div class="toast-body">
                            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation-triangle' : 'info'}-circle me-2"></i>
                            ${message}
                        </div>
                    </div>
                `;

                toastContainer.insertAdjacentHTML('beforeend', toastHtml);
                
                const toastElement = document.getElementById(toastId);
                const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
                toast.show();

                setTimeout(() => {
                    toastElement.remove();
                }, 4000);
            }
        }

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            window.panaderiaApp = new PanaderiaApp();
        });

        console.log('üçû Sistema de Panader√≠a cargado correctamente');
    </script>
</body>
</html>
